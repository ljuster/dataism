.container
  %hr
  %div.showcase__section#bubble
    %div.spacer.small
    %div#bubbleplots
      %div.bubbleplot{'data-num': 0}
        %div.plot#plotdiv
        %div.control-row
          Statistic:
          %select.statdata
  - if !@hide
    %div.alert-link=link_to('win/loss analysis',:controller => :welcome, :action => :'win_loss_viz')

:javascript

  function unpack(rows, key) {
    return rows.map(function(row) {
      return row;
    });
  }

  var allStatNames = unpack(#{@df.data.keys},0);
  var data = #{@df.data.to_json}
  var chosenStat = null;

  function getStatData(chosenStat) {
    currentStat1 = [];
    currentStat2 = [];
    for (var i = 0; i < allStatNames.length ; i++) {
      if (allStatNames[i] === chosenStat) {
        currentStat1.push(#{@df.data['overall'][:raw]});
        currentStat2.push(data[chosenStat]['raw']);
      }
    }
  };

  // Default Stat Data
  if (chosenStat != null){
      setBubblePlot(chosenStat);
    }else{
      setBubblePlot('scoring_margin');
    }

  function setBubblePlot(chosenStat) {
    getStatData(chosenStat);

    var trace1 = {
      x: currentStat1[0],
      y: currentStat2[0],
      text: #{@df.data['team_name'][:raw]},
      mode: 'markers',
      marker: {
        size: 12,
        opacity: 0.5
      }
    };

    var data = [trace1];

    var layout = {
      title: 'Correlation between<br>' + chosenStat + ' and conference ranking',
      xaxis: {
        title: 'Ranking'
      },
      yaxis: {
        title: chosenStat
        },
    };

    Plotly.newPlot('plotdiv', data, layout);
  };

  var innerContainer = document.getElementById('bubble'),
    statSelector = innerContainer.querySelector('.statdata');

  function assignOptions(textArray, selector) {
    for (var i = 0; i < textArray.length; i++) {
      var currentOption = document.createElement('option');
      currentOption.text = textArray[i];
      selector.appendChild(currentOption);
    }
  }

  assignOptions(allStatNames, statSelector);

  function updateStat() {
    setBubblePlot(statSelector.value);
  }

    statSelector.addEventListener('change', updateStat, false);


